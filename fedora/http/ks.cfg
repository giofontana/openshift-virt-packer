# Specifies the installation is text-based
text

# 1. Point to the online Fedora repository for packages
url --url="https://mirror.umd.edu/fedora/linux/releases/42/Server/x86_64/os/"

# System language, keyboard layout, and timezone
lang en_US.UTF-8
keyboard --xlayouts='us'
timezone America/New_York --isUtc

# Network information
network --bootproto=dhcp --device=link --activate --onboot=on

# Set the root password (here set to 'packer')
rootpw --plaintext packer

# Create a non-root user for Packer to SSH with
user --name=packer --groups=wheel --password=packer --plaintext

# System bootloader configuration
bootloader --location=mbr --boot-drive=vda

# Disk partitioning information
zerombr
clearpart --all --initlabel
autopart --type=lvm

# Firewall configuration - allows SSH
firewall --enabled --service=ssh

# The installation is finished, reboot the machine
reboot

# 2. Use Fedora's standard package group
%packages --ignoremissing
@standard
%end

%post
# Post-installation script (runs after packages are installed)
echo "packer ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/packer
chmod 0440 /etc/sudoers.d/packer
echo "Fedora post-install configuration complete."
%end
